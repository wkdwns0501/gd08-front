<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자 야구 게임</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> 
</head>
<body>
    <h3>숫자 야구 게임</h3>
    <div id="wrap">
        <div id="card"></div> <!-- img 태그들 -->
        <div id="left">
            <input type="text" id="userNum">
            <input type="button" value="입력" id="inbtn">
        </div>
        <div id="result"></div>
    </div>
    <script>
        let trycount = 0;
        let nums = new Array(10); // 0~9 까지의 값을 가진 배열
        let answer = new Array(4); // 4자리 정답
        let inputArr = new Array(4); // 사용자가 입력한 숫자 각각의 자리수를 배열로 저장
        // 정답 생성
        // nums : [0 1 2 3 4 5 6 7 8 9]
        for (let i = 0; i < nums.length; i++) {
            nums[i] = i;  // 0~9 사이의 값을 각각 배열로 저장
        }
        // nums 배열의 숫자들을 섞기
        for (let a = 0; a < 10000; a++) {
            let ran = Math.floor(Math.random() * nums.length);
            let temp = nums[0];
            nums[0] = nums[ran];
            nums[ran] = temp;
        }
        // nums 배열의 0~3 까지의 값들을 answer배열에 저장
        for (let i = 0; i < answer.length; i++) {
            answer[i] = nums[i];
        }
        console.log("answer=" + answer); // 중복되지 않은 4자리 숫자 (정답)

        window.onload = function() {
            for (let i = 0; i < 4; i++) {
                let img = document.createElement("img"); // <img> 태그 생성
                img.setAttribute("width", 100);                 // <img width=100, height=100, border=1>
                img.setAttribute("height", 100);
                img.setAttribute("border", 1);
                document.querySelector("#card").append(img);
            }
            document.querySelector("#inbtn").onclick = function() { // 입력 버튼이 클릭되는 경우
                let v_userNum = document.querySelector("#userNum").value; // 사용자가 입력한 숫자 4자리
                // 입력값 검증
                if (v_userNum == "") {
                    alert("숫자를 입력해주세요.");
                    document.querySelector("#userNum").focus();
                    return;
                }
                if (isNaN(v_userNum)) { // isNaN : 숫자가 아닌 경우 true
                    alert("숫자 타입으로 입력해주세요.");
                    document.querySelector("#userNum").focus();
                    return;
                }
                if (v_userNum.length != 4) {
                    alert("4자리 숫자로 입력해주세요.");
                    document.querySelector("#userNum").focus();
                    return;
                }
                // 4자리 숫자가 중복되는 것을 검증
                let userNumArr = v_userNum.split("");
                // 방법 1 // Set은 중복을 허용하지 않으므로 중복이 생기면 배열의 길이가 줄게된다
                let dup = new Set(userNumArr); 
                if (dup.size !== userNumArr.length) {
                    alert("숫자 중복 입력은 불가능합니다.")
                    document.querySelector("#userNum").focus();
                    return;
                }
                // 방법 2
                // let dup = userNumArr.some((num,index)=>{
                //     return userNumArr.indexOf(num) !== index;
                // })
                // if (dup) {
                //     alert("숫자 중복 입력은 불가능합니다.")23
                //     document.querySelector("#userNum").focus();
                //     return;
                // }

                matchingNum(v_userNum);
                document.querySelector("#userNum").value="";
            }
            document.querySelector("#userNum").onkeyup = function(event){
                //keyCode : 키 값의 아스키코드값
                if (event.keyCode == 13) { // Enter 키 입력된 경우
                    document.querySelector("#inbtn").onclick();
                }
            }
        }
        function matchingNum(userNum) {
            let strike = 0;
            let ball = 0;
            let inputArr = userNum.split(""); // 4자리 숫자 각각의 배열에 한자리씩 저장
            // 스트라이크와 볼 찾기
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++){
                    if (answer[j] == inputArr[i]) {
                        if (i == j) strike++; // 자리수가 같은 경우
                        else ball++; // 자리수가 다른 경우
                    }
                }
            }
            if (strike == 4) { // 정답인 경우
                let wrap = document.querySelector("#wrap");
                let h1_1 = 
                document.querySelector("#result").innerHTML += ("<h1>축하합니다. 정답입니다.</h1>");
                document.querySelector("#wrap").innerHTML += "<button>다시 시작</button>"; // 문자열 방식으로 동적 태그 추가
                document.querySelector("button").onclick = function() { // 다시 시작 버튼
                    location.reload(); // 현재 페이지를 다시 호출 (새로고침)
                }
                // 정답을 이미지로 표시
                cimgs = document.getElementsByTagName("img"); // 4개의 이미지 태그
                for (let i in cimgs) {
                    cimgs[i].src = "./nums/num" + answer[i] + ".jpg"; // 숫자 이미지 설정
                }
            } else { // 정답이 아닌 경우
                strike += "S ";
                ball += "B";
                let result_div = document.querySelector("#result");
                result_div.innerHTML += ++trycount + "번째 도전 : " + strike + ball + 
                                                    ", 유저 입력값 : " + userNum + "<br>";
            }
        }
    </script>
</body>
</html>