<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ í”„ë¡œì íŠ¸ - ê²Œì„ ë§Œë“¤ê¸° (ë‘ë”ì§€ ì¡ê¸°)</title>
    <style>
        body { /* ì „ì²´ */
            height: 100vh; /* ì‚¬ìš©ì ì°½(ë·°í¬íŠ¸)ì— 100% */
            background-color: #eef7f3; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container { /* ë‚´ìš© ì»¨í…Œì´ë„ˆ */
            width: 500px;
            padding: 20px;
            text-align: center;
            align-items: center;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        h1 { /* ì œëª© */
            color: brown; 
            margin: 0;
            margin-bottom: 20px;
        }
        .nav { /* score-box 2ê°œ + startBtn */
            width: 440px;
            margin: 0px 30px 20px 30px;
            display: flex;
            justify-content: space-between;
        }
        .panel { /* score-box 2ê°œ */
            display: flex;
        }
        .score-box { /* score + time */
            background-color: antiquewhite;
            height: 50px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }
        .score-box p { 
            font-size: 17px; 
            margin: 0; 
        }
        .score-box div { 
            font-size: 18px; 
            font-weight: bold;
        }
        #gameField { /* ë‘ë”ì§€ê²Œì„ í•„ë“œ */
            width: 400px;
            height: 400px;
            display: grid;
            /* ì„¸ë¡œì¤„(ì—´) 3ê°œ (ë„ˆë¹„ ê· ë“±) */
            grid-template-columns: repeat(3, 1fr); 
            /* ê°€ë¡œì¤„(í–‰) 3ê°œ (ë†’ì´ ê· ë“±) */
            grid-template-rows: repeat(3, 1fr);
            gap: 20px;
            padding: 20px;
            margin: 0 auto;
            border-radius: 15px;
            border: 2px solid gray;
            background-color: #a0522d; /* í™ ìƒ‰ê¹” */
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.4);
        }
        .mole-hole { /* ë‘ë”ì§€ êµ¬ë© */
            background-color: #795548;
            border: 3px solid #5d4037;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: flex-end; 
            overflow: hidden; 
            position: relative;
        }
        .mole { /* ë‘ë”ì§€ */
            width: 100%;
            height: 100%;
            background-color: #8d6e63;
            border-radius: 50%;
            bottom: -100%; /* ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°€ ìˆëŠ” ìƒíƒœ */
            /* 0.2ì´ˆ ë™ì•ˆ ë¹ ë¥´ê²Œ ì‹œì‘í•´ì„œ ëŠë¦¬ê²Œ ëë‚˜ëŠ” íŒ¨í„´ìœ¼ë¡œ ì›€ì§ì—¬ë¼ */
            transition: bottom 0.2s ease-out; /* ë‘ë”ì§€ ì›€ì§ì„ */
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: absolute;
        }
        /* mole-holeê³¼ mole-up ë™ì‹œì— ê°€ì§„ ìš”ì†Œ ì•ˆì— ìì‹ìš”ì†Œì¸ mole ì„ íƒ */
        .mole-hole.mole-up .mole { /* êµ¬ë©ì—ì„œ ì˜¬ë¼ì˜¨ ë‘ë”ì§€ ìš”ì†Œ */
            bottom: 0%; /* ì™„ì „íˆ ì˜¬ë¼ì˜¨ ìƒíƒœ */
            cursor: pointer;
        }
        /* ì˜¬ë¼ì˜¨ ë‘ë”ì§€ë¥¼ í´ë¦­ì‹œ */
        .mole-up img:active {
            transform: scale(0.9);
            transition: transform 0.1s;
        }
        #statusDisplay { /* ìƒíƒœ í‘œì‹œ */
            min-height: 25px;
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        #startBtn { /* ì‹œì‘ ë²„íŠ¼ */
            width: 86px;
            background-color: #ffd32a;
            color: white;
            cursor: pointer;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-left: 10px;
        }
        #startBtn:hover {
            background-color: #ffc048;
        }
        #resetBtn {
            width: 86px;
            background-color: #1dd1a1;
            color: white;
            cursor: pointer;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-left: 10px;
        }
        #resetBtn:hover {
            background-color: #10ac84;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦” ë‘ë”ì§€ ì¡ê¸° ê²Œì„ ğŸ¦”</h1>
        <div class="nav">
            <div class="panel">
                <div class="score-box">
                    <p>ì ìˆ˜</p>
                    <div id="scoreDisplay">0</div>
                </div>
                <div class="score-box">
                    <p>ë‚¨ì€ ì‹œê°„(ì´ˆ)</p>   
                    <div id="timeDisplay">30</div>
                </div>
            </div>
            <div class="panel">
                <button id="resetBtn">ì´ˆê¸°í™”</button>
                <button id="startBtn">ê²Œì„ì‹œì‘</button>
            </div>
        </div>
        <div id="gameField"></div>
        <div id="statusDisplay">ê²Œì„ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”!</div>
    </div>

    <script>
        // ìš”ì†Œ ì„¤ì •
        const gameField = document.getElementById('gameField');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const statusDisplay = document.getElementById('statusDisplay');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
         // ê²Œì„ ì„¤ì •
        const gameTime = 30;        // ì´ ê²Œì„ ì‹œê°„ (30ì´ˆ)
        const holeCnt = 9;              // êµ¬ë© ê°œìˆ˜ (3x3 ê·¸ë¦¬ë“œ)
        const moleCycle = 1100;      // ë‘ë”ì§€ê°€ ìƒˆë¡œ ë‚˜ì˜¤ëŠ” ì£¼ê¸° (1.1ì´ˆ)
        const moleHide = 800;       // ë‘ë”ì§€ê°€ ìˆ¨ëŠ” ì‹œê°„ (0.8ì´ˆ)
        // ê²Œì„ ìƒíƒœ
        let isGameActive = false;        // ê²Œì„ í™œì„±í™” ìƒíƒœ
        let score = 0;                        // ì ìˆ˜
        let remainTime = gameTime; // ë‚¨ì€ ì‹œê°„
        let lastHoleIndex = -1;          // ë§ˆì§€ë§‰ êµ¬ë© ìœ„ì¹˜
        // íƒ€ì´ë¨¸
        let gameTimer = null;           // ì‹œê°„ ì¹´ìš´íŠ¸
        let moleInterval = null;         // ë‘ë”ì§€ ì¶œí˜„ ì£¼ê¸°
        let moleTimeout = null;         // ë‘ë”ì§€ ìˆ¨ê¹€ ì£¼ê¸°
        // í™”ë©´ ì‹œì‘ì‹œ êµ¬ë© ë§Œë“¤ê¸° (ì´ˆê¸° ì‹¤í–‰)
        window.onload = () => {
            createHoles();
        }
        // êµ¬ë© ìƒì„±
        let holes = []; //ì „ì—­ ë³€ìˆ˜
        function createHoles() {
            gameField.innerHTML = ""; // ê²Œì„ í•„ë“œ ì´ˆê¸°í™”
            holes = []; // holes ë°°ì—´ ì´ˆê¸°í™”
            for (let i = 0; i < holeCnt; i++) { // êµ¬ë© 9ê°œ ìƒì„±
                // êµ¬ë© ìš”ì†Œ <div class="mole-hole" data-index="i">
                const holeEl = document.createElement("div");
                holeEl.classList.add("mole-hole"); // í´ë˜ìŠ¤ ì¶”ê°€
                holeEl.dataset.index = i; // êµ¬ë© ì¸ë±ìŠ¤ ì„¤ì •
                // ë‘ë”ì§€ ìš”ì†Œ
                const moleDivEl = document.createElement("div");
                moleDivEl.classList.add("mole"); // í´ë˜ìŠ¤ ì¶”ê°€
                const moleImgEl = document.createElement("img");
                moleImgEl.src = "img/mole.png";
                moleImgEl.style.width = '85px';
                moleImgEl.style.height = '100px';
                moleDivEl.appendChild(moleImgEl); // ë‘ë”ì§€div ìš”ì†Œì— ë‘ë”ì§€img ìš”ì†Œ ë„£ê¸°
                holeEl.appendChild(moleDivEl); // êµ¬ë© ìš”ì†Œì— ë‘ë”ì§€ ê²°í•© ìš”ì†Œ ë„£ê¸°
                // ê²°í•©ëœ êµ¬ë© ìš”ì†Œë¥¼ í´ë¦­ì‹œ clickMole ì‹¤í–‰
                holeEl.addEventListener('click', clickMole); 
                gameField.appendChild(holeEl); // ê²Œì„ í•„ë“œì— êµ¬ë©+ë‘ë”ì§€ ìš”ì†Œë¥¼ ë„£ê¸°
                holes.push(holeEl); // êµ¬ë© ë°°ì—´ì— êµ¬ë© ìš”ì†Œ ì¶”ê°€
            }
        }
        // êµ¬ë© ëœë¤ ì„ íƒ
        function pickRandomHole() {
            let randomIndex;
            do { // 1íšŒ ëœë¤ ìƒì„± í›„ ì´ì „ ì¸ë±ìŠ¤ì™€ ëœë¤ ì¸ë±ìŠ¤ê°€ ê°™ë‹¤ë©´ ëœë¤ ì¸ë±ìŠ¤ ì¬ìƒì„±
                randomIndex = Math.floor(Math.random() * holeCnt);
            } while (randomIndex === lastHoleIndex);
            lastHoleIndex = randomIndex; // ë‹¤ìŒ ë¹„êµë¥¼ ìœ„í•´ ëœë¤ ì¸ë±ìŠ¤ ì €ì¥
            return holes[randomIndex]; // holes ë°°ì—´ì˜ ëœë¤ ì¸ë±ìŠ¤ ê°’ ë°˜í™˜
        }
        // ë‘ë”ì§€ ì¶œí˜„
        function showMole(holeEl) {
            holeEl.classList.add("mole-up");
        }
        // ë‘ë”ì§€ ìˆ¨ê¹€
        function hideMole(holeEl) {
            holeEl.classList.remove("mole-up");
        }
        // ë‘ë”ì§€ í´ë¦­
        function clickMole(event) {
            if (!isGameActive) return;
            // í´ë¦­í•œ <div class="mole-hole"> ì»¨í…Œì´ë„ˆ ìì²´ 
            const hole = event.currentTarget;  
            // ë‘ë”ì§€ê°€ ì˜¬ë¼ì™€ ìˆëŠ” ìƒíƒœì¸ì§€ í™•ì¸ 
            if (!hole.classList.contains('mole-up')) {
                miss();
                return; 
            }
            // í´ë¦­ëœ ìš”ì†Œê°€ ì‹¤ì œ IMG íƒœê·¸ë¼ë©´
            if (event.target.tagName === 'IMG') {
                // ë‘ë”ì§€ê°€ ì˜¬ë¼ì™€ ìˆê³ , ì´ë¯¸ì§€ ìì²´ í´ë¦­
                hit();
                hideMole(hole); // ë‘ë”ì§€ ìˆ¨ê¹€
            } else {
                // ë‘ë”ì§€ëŠ” ì˜¬ë¼ì™€ ìˆì§€ë§Œ, ì´ë¯¸ì§€ ì£¼ë³€ ì—¬ë°± í´ë¦­
                miss();
            }
        }
        // í™ ë°”ë‹¥(êµ¬ë© ì‚¬ì´)ì„ í´ë¦­í–ˆì„ ë•Œ Miss ì²˜ë¦¬ ë¦¬ìŠ¤ë„ˆ
        gameField.addEventListener('click', (event) => {
            // í´ë¦­ ëŒ€ìƒì´ gameField ìì²´ì´ê³  (êµ¬ë©ì´ ì•„ë‹Œ í™ ë°”ë‹¥), ê²Œì„ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì²˜ë¦¬
            if (event.target.id === 'gameField' && isGameActive) {
                miss();
            }
        });
        // Hit ì²˜ë¦¬
        function hit() {
            score += 3;
            scoreDisplay.textContent = score;
            statusDisplay.textContent = 'Hit! (+3ì )';
            statusDisplay.style.color = 'blue';
        }
        // Miss ì²˜ë¦¬
        function miss() {
            if (score > 0) score--;
            scoreDisplay.textContent = score;
            statusDisplay.textContent = 'Miss... (-1ì )';
            statusDisplay.style.color = 'red';
        }
        // ê²Œì„ ì‹œì‘ ë¦¬ìŠ¤ë„ˆ
        startBtn.addEventListener('click',startGame);
        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (isGameActive) return;
            isGameActive = true; // ê²Œì„ í™œì„±í™”
            score = 0;
            scoreDisplay.textContent = score; // ì ìˆ˜ ì¶œë ¥
             // ëª¨ë“  íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            clearInterval(gameTimer);
            clearInterval(moleInterval);
            clearTimeout(moleTimeout);
            startBtn.textContent = "ì§„í–‰ì¤‘..."
            startBtn.disabled = true;
            resetBtn.disabled = false;
            statusDisplay.textContent = `${gameTime}ì´ˆ ë™ì•ˆ ë‘ë”ì§€ë¥¼ ì¡ìœ¼ì„¸ìš”!`;
            statusDisplay.style.color = "green";
            // ì‹œê°„ íƒ€ì´ë¨¸ ì‹œì‘
            startTimer();
            // 1.1ì´ˆë§ˆë‹¤ popMoleCycle í•¨ìˆ˜ ì‹¤í–‰
            moleInterval = setInterval(popMoleCycle, moleCycle);
        }
        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            if (!isGameActive) return;
            isGameActive = false; // ê²Œì„ ë¹„í™œì„±í™”
            // ëª¨ë“  íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            clearInterval(gameTimer);
            clearInterval(moleInterval);
            clearTimeout(moleTimeout);
            // êµ¬ë©ì— ëª¨ë“  ë‘ë”ì§€ ìˆ¨ê¸°ê¸°
            holes.forEach(hideMole);
            startBtn.textContent = "ë‹¤ì‹œì‹œì‘";
            startBtn.disabled = false;
            statusDisplay.textContent = `ê²Œì„ ì¢…ë£Œ!  ìµœì¢… ì ìˆ˜ : ${score} ì `;
            statusDisplay.style.color = "red";
        }
        // ê²Œì„ ì´ˆê¸°í™” ë¦¬ìŠ¤ë„ˆ
        resetBtn.addEventListener('click',resetGame);
        // ê²Œì„ ì´ˆê¸°í™”
        function resetGame() {
            //ëª¨ë“  íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            clearInterval(gameTimer);
            clearInterval(moleInterval);
            clearTimeout(moleTimeout);
            // êµ¬ë©ì— ëª¨ë“  ë‘ë”ì§€ ìˆ¨ê¸°ê¸°
            holes.forEach(hideMole); 
            isGameActive = false;
            score = 0;
            scoreDisplay.textContent = score;
            remainTime = gameTime;
            timeDisplay.textContent = remainTime;
            startBtn.textContent = "ê²Œì„ì‹œì‘";
            startBtn.disabled = false;
            resetBtn.disabled = false;
            statusDisplay.textContent = "ê²Œì„ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”!";
            statusDisplay.style.color = "black";
        }
        // ì‹œê°„ ì„¤ì •
        function startTimer() {
            // ê²Œì„ì´ ì‹œì‘ë  ë•Œ ë‚¨ì€ì‹œê°„ì„ ê²Œì„ ì„¤ì • ì‹œê°„ìœ¼ë¡œ ì´ˆê¸°í™”
            remainTime = gameTime;
            // ë‚¨ì€ ì‹œê°„ ì¶œë ¥
            timeDisplay.textContent = remainTime;
            // 1ì´ˆë§ˆë‹¤ ë‚¨ì€ ì‹œê°„ 1 ê°ì†Œ í›„ ë‚¨ì€ ì‹œê°„ ì—…ë°ì´íŠ¸
            gameTimer = setInterval(() => {
                remainTime--;
                timeDisplay.textContent = remainTime; 
                if (remainTime <= 0) { // ì‹œê°„ì´ 0ì´ë˜ë©´ ê²Œì„ ì¢…ë£Œ
                    endGame();
                }
            }, 1000); // 1ì´ˆ
        }
        // ë‘ë”ì§€ ì¶œí˜„, ìˆ¨ê¹€ ì£¼ê¸°
        function popMoleCycle() {
            if (!isGameActive) return;
             // ì´ë¯¸ ì˜¬ë¼ì™€ ìˆëŠ” ë‘ë”ì§€ê°€ ìˆë‹¤ë©´ ì´ë²ˆ ì£¼ê¸° ê±´ë„ˆëœ€
            if (document.querySelector('.mole-up')) return;
            // ë‘ë”ì§€ê°€ ë‚˜ì˜¬ ë‹¤ìŒ êµ¬ë©ì„ ëœë¤ìœ¼ë¡œ ì§€ì •
            const nextHole = pickRandomHole(); 
            showMole(nextHole); // ëœë¤ ìœ„ì¹˜ì— ë‘ë”ì§€ ì¶œí˜„
            statusDisplay.textContent = "ë‘ë”ì§€ ë“±ì¥!";
            statusDisplay.style.color = "orange";

            moleTimeout = setTimeout(() => {
                hideMole(nextHole);
                moleTimeout = null; // íƒ€ì„ì•„ì›ƒ í•´ì œ í‘œì‹œ
            }, moleHide); // 0.8ì´ˆ
        }
    </script>
</body>
</html>